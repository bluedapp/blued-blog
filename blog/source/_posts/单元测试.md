---
uuid: d259c080-5dc4-11e7-ba95-9f6608e46c55
author: mxx
email: mengxxself
title: React--单元测试
date: 2017-07-01 02:49:18
tags: React
---

### 单元测试的概念

> 单元测试 是针对 程序的最小单元 来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。一个单元可能是单个程序、类、对象、方法等


一般对于复用性较高的组件需要进行单元测试

* 测试元素

```html
<div class='header'></div>
```
测试其class属性值是不是‘Header’

* 测试函数

```JavaScript
function test (arg){
  return Boolean(arg)
}
```
测试其返回值是否为正确的布尔值

* 测试行为

```html
<button onclick='javascript:alert("i am alert")' >click me</button>
```
测试点击行为是否触发正确结果


### 常用工具

* 1 [karma](http://karma-runner.github.io/1.0/index.html)

> Karma是一个基于Node.js的JavaScript测试执行过程管理工具

karma会启动一个web服务器，将js源代码和测试脚本放到PhantomJS或者Chrome上执行

* 2 [PhantomJS](http://phantomjs.org/)

> PhantomJS 是一个基于 WebKit 的服务器端 JavaScript API。它全面支持web而不需浏览器支持，其快速，原生支持各种Web标准： DOM 处理, CSS 选择器, JSON, Canvas, 和 SVG。 PhantomJS 可以用于 页面自动化 ， 网络监测 ， 网页截屏 ，以及 无界面测试 等

可以将其理解为-个虚拟的具有webkit内核的浏览器环境

* 3 [Jasmine](https://jasmine.github.io/2.6/introduction)

> jasmine是一款测试框架，它不依赖于其他任何 JavaScript 组件

Jasmine 断言库 是单元测试的语句编译规则

Jasmine 语法规则

* describe(string, function) 测试集，官方称之为suite
主要功能是用来划分单元测试的，describe是可以嵌套使用的

| 参数 | 说明 |
| --- | --- | --- | --- | --- |
| string | 描述测试集的信息
| function | 测试集的具体实现


* it(string, function) 测试用例 官方称之为spec

| 参数 | 说明 |
| --- | --- | --- | --- | --- |
| string | 描述测试用例的信息
| function | 测试用例的具体实现


简单的测试案例
```JavaScript
describe('suite describe', function() {
  it('spec describe', function() {
    ......
  })
})
```
* expect() 断言

| 参数 | 说明 |
| --- | --- | --- | --- | --- |
| arg | 要测试的实际值

断言语句,以expect语句表示，返回true或false

只有当一个测试用例中的所有的断言语句全为true时，这个Spec才通过，否则失败


常用的断言语句为

```JavaScript
expect(x).toEqual(y) //比较x和y是否相等
expect(x).not.toEqual(y) //比较x和y是否不相等
expect(x).toBe(y) //比较x和y是否是相同的对象
expect(x).toBeDefined() //x是否为undefined
expect(x).toBeNull() //x是否为null
expect(x).toBeTruthy() //x是否为true
expect(x).toBeFalsy() //x是否为false
expect(x).toContain(y) //x是否包含y (x可以是字符串或数组)
```

断言语句使用案例

```JavaScript
expect(1).toBe(1)
expect('a').not.toBe('b')
expect(false).toEqual(false)
```

* 4 [Enzyme](http://airbnb.io/enzyme/index.html)

> Airbnb开源的 React 测试类库

Enzyme 是非常友好的React测试工具 提供了类似于jQuery API的react节点选取方式


### 单元测试--代码覆盖率

单元测试中常用代码覆盖率来衡量有没有将组件测试完整

一般从三个方向来度量代码的覆盖程度

1. 语句覆盖
2. 判定覆盖
3. 条件覆盖

可以看到各个组件的测试覆盖率
![coverage](/img/mxx/20170526_UnitTest/coverage.png)
每一个组件还有各自代码覆盖率详情 如果测试用例没有覆盖到某一个组件或者函数 也会有提示
![coverage](/img/mxx/20170526_UnitTest/coverage-page.png)




### 单元测试实例展示

1 测试元素

React公共组件Header结构如下
```html
export default () => {
  return (
    <div className='header'>
      <div className='header-button' />
    </div>

  )
}

```

单元测试要点
1 测试元素 .header 是否存在
2 测试元素 .header-button 是否存在

单元测试断言
```html

```
